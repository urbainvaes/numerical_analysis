\usepackage[margin=1in]{geometry}
\usepackage[dvipsnames]{xcolor}
\usepackage[sf,bf]{titlesec}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts,amssymb}
\usepackage{mathtools}
\usepackage{framed}
\usepackage{mdframed}
\usepackage[style=trad-abbrv,doi=true,url=true,isbn=false,backend=bibtex]{biblatex}
\usepackage{setspace}
\usepackage{algpseudocode}
\usepackage{algorithm}
\usepackage{fontawesome}
\usepackage{hyperref}
\usepackage[nameinlink,capitalise]{cleveref}
\usepackage{multicol}
\usepackage{tikz-cd}

% \setlength{\parskip}{4pt}
\onehalfspacing

\usepackage{pgfplots}
\pgfplotsset{compat=1.16}
\usetikzlibrary{graphs,graphdrawing}
\usetikzlibrary{backgrounds}
\usetikzlibrary{intersections,calc}
\usegdlibrary{trees}
\usegdlibrary{force}

% Code listings
\usepackage[cache=true,outputdir=build]{minted}
\usepackage{caption}
\newenvironment{code}{\captionsetup{type=listing}}{}
% \SetupFloatingEnvironment{listing}{name=Listing}

% Colors
\definecolor{lightblue}{HTML}{f1f8fb}
\definecolor{lightgreen}{HTML}{f1fbf4}
\definecolor{lightindigo}{HTML}{f3f1fb}
\definecolor{darkgray}{HTML}{555555}
\definecolor{darkblue}{HTML}{315a88}
\definecolor{lightred}{HTML}{f8f6ee}
\definecolor{lightcyan}{rgb}{0.84,1,1}
\definecolor{lightred}{rgb}{1,0.7,0.71}
\definecolor{nicegreen}{rgb}{0.64,1,0.71}

\hypersetup{%
    linktocpage=true,
    colorlinks=true,
    urlcolor=darkblue,
    linkcolor=darkblue,
    citecolor=darkblue,
    pdfauthor={Urbain Vaes}
    pdftitle={Lecture notes in Numerical Analysis}
    pdfsubject={Applied mathematics}
}

% Define frames
\newenvironment{myframe}
{%
    \begin{mdframed}[
        leftmargin=0cm,
        skipabove=.3cm,
        linecolor=blue,
        backgroundcolor=lightblue,
        linewidth=0pt,
        innerleftmargin=.5em,
        innerrightmargin=.5em,
        innertopmargin=.3em,
        innerbottommargin=.6em,
    ]
}
{
    \end{mdframed}
}

\newenvironment{remarkframe}
{%
    \begin{mdframed}[
        leftmargin=0cm,
        skipabove=.3cm,
        linecolor=blue,
        backgroundcolor=lightindigo,
        linewidth=0pt,
        innerleftmargin=.5em,
        innerrightmargin=.5em,
        innertopmargin=.3em,
        innerbottommargin=.6em,
    ]
}
{
    \end{mdframed}
}

\newenvironment{solutionframe}
{%
    \begin{mdframed}[
        leftmargin=0cm,
        skipabove=.3cm,
        linecolor=blue,
        backgroundcolor=lightgreen,
        linewidth=0pt,
        innerleftmargin=.5em,
        innerrightmargin=.5em,
        innertopmargin=.3em,
        innerbottommargin=.6em,
    ]
}
{
    \end{mdframed}
}

% Fonts for lualatex
\usepackage{fontspec}
% \setmonofont{Monaco}[Scale=MatchLowercase,BoldFont=DejaVu sans Mono-bold]
% \setmonofont{DejaVu sans Mono}[Scale=MatchLowercase,BoldFont=DejaVu sans Mono-bold]
\setmonofont{Latin Modern Mono}[%
    Scale=MatchLowercase,
    ItalicFont=Latin Modern Mono,
    BoldItalicFont=DejaVu sans Mono-bold,
    BoldFont=DejaVu sans Mono-bold]
% \setmainfont{DejaVu Serif}
\usepackage{newunicodechar}
% To check that a font supports Greek letters, try 'albatross α'
\newfontfamily{\fallbackfont}{DejaVu Sans Mono}[Scale=MatchLowercase]
\DeclareTextFontCommand{\textfallback}{\fallbackfont}
\newunicodechar{α}{\textfallback{α}}
\newunicodechar{β}{\textfallback{β}}
\newunicodechar{γ}{\textfallback{γ}}
\newunicodechar{δ}{\textfallback{δ}}
\newunicodechar{ε}{\textfallback{ε}}
\newunicodechar{ζ}{\textfallback{ζ}}
\newunicodechar{η}{\textfallback{η}}
\newunicodechar{θ}{\textfallback{θ}}
\newunicodechar{ι}{\textfallback{ι}}
\newunicodechar{κ}{\textfallback{κ}}
\newunicodechar{λ}{\textfallback{λ}}
\newunicodechar{μ}{\textfallback{μ}}
\newunicodechar{ν}{\textfallback{ν}}
\newunicodechar{ξ}{\textfallback{ξ}}
\newunicodechar{ο}{\textfallback{ο}}
\newunicodechar{π}{\textfallback{π}}
\newunicodechar{ρ}{\textfallback{ρ}}
\newunicodechar{σ}{\textfallback{σ}}
\newunicodechar{τ}{\textfallback{τ}}
\newunicodechar{υ}{\textfallback{υ}}
\newunicodechar{φ}{\textfallback{φ}}
\newunicodechar{χ}{\textfallback{χ}}
\newunicodechar{ψ}{\textfallback{ψ}}
\newunicodechar{ω}{\textfallback{ω}}
\newunicodechar{Α}{\textfallback{Α}}
\newunicodechar{Β}{\textfallback{Β}}
\newunicodechar{Γ}{\textfallback{Γ}}
\newunicodechar{Δ}{\textfallback{Δ}}
\newunicodechar{Ε}{\textfallback{Ε}}
\newunicodechar{Ζ}{\textfallback{Ζ}}
\newunicodechar{Η}{\textfallback{Η}}
\newunicodechar{Θ}{\textfallback{Θ}}
\newunicodechar{Ι}{\textfallback{Ι}}
\newunicodechar{Κ}{\textfallback{Κ}}
\newunicodechar{Λ}{\textfallback{Λ}}
\newunicodechar{Μ}{\textfallback{Μ}}
\newunicodechar{Ν}{\textfallback{Ν}}
\newunicodechar{Ξ}{\textfallback{Ξ}}
\newunicodechar{Ο}{\textfallback{Ο}}
\newunicodechar{Π}{\textfallback{Π}}
\newunicodechar{Ρ}{\textfallback{Ρ}}
\newunicodechar{Σ}{\textfallback{Σ}}
\newunicodechar{Τ}{\textfallback{Τ}}
\newunicodechar{Υ}{\textfallback{Υ}}
\newunicodechar{Φ}{\textfallback{Φ}}
\newunicodechar{Χ}{\textfallback{Χ}}
\newunicodechar{Ψ}{\textfallback{Ψ}}
\newunicodechar{Ω}{\textfallback{Ω}}

% Style of sections (sectsty)
% \usepackage{sectsty}
% \allsectionsfont{\sffamily}
% \sectionfont{\sffamily\color{darkblue}}

% Style of sections (titlesec)
\makeatletter
\newcommand*\@secondofsix[6]{#2}
\newcommand{\addtotitleformat}{%
  \@ifstar{\addtotitleformat@star}{\addtotitleformat@nostar}}
\newcommand\addtotitleformat@nostar[2]{%
  \PackageError{titlesec}{non starred form of \string\addtotitleformat\space not supported}{}}
\newcommand\addtotitleformat@star[2]{%
  \expandafter\expandafter\expandafter\expandafter
  \expandafter\expandafter\expandafter\def
  \expandafter\expandafter\expandafter\expandafter
  \expandafter\expandafter\expandafter\@currentsection@font
  \expandafter\expandafter\expandafter\expandafter
  \expandafter\expandafter\expandafter{%
    \expandafter\expandafter\expandafter\@secondofsix
       \csname ttlf@\expandafter\@gobble\string#1\endcsname}%
  \titleformat*{#1}{\@currentsection@font#2}}
\makeatother
\addtotitleformat*{\section}{\color{darkblue}}

% Numbering of equations
\numberwithin{equation}{chapter}

% Equations and theorems
\theoremstyle{plain}% default
\newtheorem{prototheorem}{Theorem}[chapter]
\newtheorem{protoproposition}[prototheorem]{Proposition}
\newtheorem{protolemma}[prototheorem]{Lemma}
\newtheorem{protocorollary}[prototheorem]{Corollary}
\newtheorem{protoexercise}{{\normalfont \faGears}~Exercise}[chapter]
\newtheorem{protocompexercise}[protoexercise]{{\normalfont \faLaptop}~Exercise}
\newtheorem{task}{{\normalfont \faLaptop}~Task}
\theoremstyle{definition}
\newtheorem{protodefinition}{Definition}[chapter]
\newtheorem{protonotation}{Notation}[chapter]
\theoremstyle{remark}
\newtheorem{protoexample}{Example}[chapter]
\newtheorem{protoremark}{Remark}[chapter]
\newtheorem*{protosolution}{Solution}

\newenvironment{solution}
{\pushQED{\qed}\renewcommand{\qedsymbol}{$\triangle$}
\begin{solutionframe}\small \begin{protosolution}}
{\popQED\end{protosolution}\end{solutionframe}}

% Minitoc
\usepackage[nohints]{minitoc}
\setcounter{tocdepth}{1}
\setcounter{minitocdepth}{2}
\renewcommand{\mtctitle}{}
\makeatletter
\renewcommand{\@pnumwidth}{2.5em}
\makeatother
\nomtcrule

% Styling of Theorems
\colorlet{theoremcolor}{lightblue}
\colorlet{propositioncolor}{lightblue}
\colorlet{lemmacolor}{lightblue}
\colorlet{corollarycolor}{lightblue}
\colorlet{examplecolor}{lightblue}
\colorlet{definitioncolor}{lightblue}
\colorlet{notationcolor}{lightblue}
\colorlet{remarkcolor}{lightindigo}
\newenvironment{theorem}
   {\colorlet{shadecolor}{theoremcolor}\begin{myframe}\begin{prototheorem}}
   {\end{prototheorem}\end{myframe}}
\newenvironment{proposition}
   {\colorlet{shadecolor}{propositioncolor}\begin{myframe}\begin{protoproposition}}
   {\end{protoproposition}\end{myframe}}
\newenvironment{lemma}
   {\colorlet{shadecolor}{lemmacolor}\begin{myframe}\begin{protolemma}}
   {\end{protolemma}\end{myframe}}
\newenvironment{corollary}
   {\colorlet{shadecolor}{corollarycolor}\begin{myframe}\begin{protocorollary}}
   {\end{protocorollary}\end{myframe}}
\newenvironment{example}
   {\begin{remarkframe}\begin{protoexample}}
   {\end{protoexample}\end{remarkframe}}
\newenvironment{definition}
   {\colorlet{shadecolor}{definitioncolor}\begin{myframe}\begin{protodefinition}}
   {\end{protodefinition}\end{myframe}}
\newenvironment{notation}
   {\colorlet{shadecolor}{notationcolor}\begin{myframe}\begin{protonotation}}
   {\end{protonotation}\end{myframe}}
\newenvironment{remark}
   {\begin{remarkframe}\begin{protoremark}}
   {\end{protoremark}\end{remarkframe}}
\newenvironment{exercise}
   {\colorlet{shadecolor}{white}\begin{protoexercise}}
   {\end{protoexercise}}
\newenvironment{compexercise}
   {\colorlet{shadecolor}{white}\begin{protocompexercise}}
   {\end{protocompexercise}}

% Links
\crefname{protolemma}{Lemma}{Lemmas}
\crefname{prototheorem}{Theorem}{Theorems}
\crefname{protoproposition}{Proposition}{Propositions}
\crefname{protocorollary}{Corollary}{Corollarys}
\crefname{protoexample}{Example}{Examples}
\crefname{protodefinition}{Definition}{Definitions}
\crefname{protoremark}{Remark}{Remarks}
\crefname{protoexercise}{Exercise}{Exercises}
\crefname{protocompexercise}{Exercise}{Exercises}
\crefname{code}{Julia listing}{Julia listings}
\crefname{figure}{Figure}{Figures}
% \Crefname{algorithm}{Algorithm}{Algorithms}

% Bibliography
\addbibresource{references.bib}
\renewcommand*{\mkbibnamegiven}[1]{\textsc{#1}}
\renewcommand*{\mkbibnamefamily}[1]{\textsc{#1}}
\DeclareFieldFormat{volume}{volume \textbf{#1}}
\DeclareFieldFormat[article]{volume}{\textbf{#1}}
\DeclareFieldFormat[book]{note}{}
\DeclareFieldFormat[book]{pages}{}
\DeclareFieldFormat{url}{\newline {\scriptsize\textsc{url}: \url{#1}}}
\DeclareFieldFormat{doi}{\newline {\scriptsize\textsc{doi}: \url{#1}}}
\renewcommand*{\bibfont}{\small}

% Custom cite command
\DeclareCiteCommand{\fullcite}
  {\usebibmacro{prenote}}
  {\clearfield{doi}%
   \clearfield{pages}%
   \clearfield{pagetotal}%
   \clearfield{edition}%
   \clearfield{labelyear}%
   \usedriver
     {\DeclareNameAlias{sortname}{default}}
     {\thefield{entrytype}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

% Headers
\usepackage{fancyhdr}
\usepackage{emptypage}

% Clear defaults
\fancyhead{}

% Left-Odd, Right-Even
\definecolor{darkgrey}{RGB}{120,120,120}
% \fancyhead[LE,RO]{\color{darkgrey}\textit{\nouppercase{\leftmark}}}
\fancyhead[R]{\color{darkgrey}\textit{\nouppercase{\leftmark}}}
% \fancyhead[LO,RE]{\color{darkgrey}\textit{\thepage}}
% \fancyhead[LO,RE]{}
% \fancyfoot[C]{\color{darkgrey}\textit{\thepage}}
\fancyfoot[C]{\thepage}
\pagestyle{fancy}
\let\oldheadrule\headrule
\renewcommand{\headrule}{}
% \renewcommand{\headrule}{\color{darkgrey}\oldheadrule}
% \renewcommand{\headrulewidth}{0pt}
\setlength{\headheight}{13.59999pt}
\setlength{\OuterFrameSep}{0pt}

\overfullrule=5pt
